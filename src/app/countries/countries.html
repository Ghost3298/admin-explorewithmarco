<app-base-list
    [pageTitle]="pageConfig.title"
    [searchPlaceholder]="pageConfig.searchPlaceholder"
    [buttonText]="pageConfig.buttonText"
    [tableColumns]="pageConfig.tableColumns"
    [popupTitle]="pageConfig.popupTitle"
    (searchChanged)="onSearchChange($event)">
    
    <app-spinner 
        [show]="isLoading" 
        message="Loading countries..."
        [fullScreen]="false">
    </app-spinner>
    
    <tbody>
        <!-- Custom table rows for countries -->
        <tr *ngIf="filteredCountries.length === 0">
            <td colspan="4" class="empty-state">
                <span *ngIf="searchTerm && countries.length > 0">
                    No countries found matching "{{ searchTerm }}"
                </span>
                <span *ngIf="!searchTerm && countries.length === 0">
                    No countries found. Click "Add Country" to create one.
                </span>
            </td>
        </tr>
        <tr *ngFor="let country of filteredCountries">
            <td>{{ country.country_name }}</td>
            <td>
                <img *ngIf="country.country_image" [src]="country.country_image" [alt]="country.country_name" class="table-image"/>
                <span *ngIf="!country.country_image" class="no-image">No image</span>
            </td>
            <td>
                <span [class]="country.status ? 'status-active' : 'status-inactive'">
                    {{ country.status ? 'Active' : 'Inactive' }}
                </span>
            </td>
            <td>
                <div class="action-buttons">
                    <app-button-shared text="Edit" variant="warning" (onClick)="editCountry(country)" size="sm"/>
                    <app-button-shared [text]="country.status ? 'Set Inactive' : 'Set Active'" [variant]="country.status ? 'danger' : 'success'" (onClick)="updateCountryStatus(country)" size="sm"/>
                </div>
            </td>
        </tr>
    </tbody>

   <div popup-content>
        <form class="popup-form" [formGroup]="countryForm" (ngSubmit)="onSubmit()">
            <!-- Country Name Field -->
            <div class="form-group">
                <label for="country_name">Country Name *</label>
                <app-input-shared 
                    id="country_name"
                    type="text" 
                    placeholder="Enter country name" 
                    formControlName="country_name"
                    [class.error]="countryName?.invalid && countryName?.touched" />
                <div *ngIf="countryName?.invalid && countryName?.touched" class="error-message">
                    <span *ngIf="countryName?.errors?.['required']">Country name is required</span>
                </div>
            </div>

            <!-- Country Image Field -->
            <div class="form-group">
                <label for="country_image">Country Image</label>
                <input 
                    id="country_image"
                    type="file" 
                    (change)="onFileSelected($event)"
                    class="form-control" />
                <div *ngIf="selectedFile" class="file-info">
                    Selected file: {{ selectedFile.name }}
                </div>
            </div>

            <div class="form-actions">
                <app-button-shared 
                    variant="secondary" 
                    text="Cancel" 
                    type="button"
                    (click)="onCancel()" />
                <app-button-shared 
                    variant="success" 
                    text="Save Country" 
                    type="submit"
                    [disabled]="countryForm.invalid" />
            </div>
        </form>
    </div>
</app-base-list>

<!-- Edit Country Popup -->
<div class="modal-overlay" *ngIf="showEditPopup" (click)="closeEditPopup()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <h3>Edit Country</h3>
            <button class="close-btn" (click)="closeEditPopup()">&times;</button>
        </div>
        <div class="modal-body">
            <form class="popup-form" [formGroup]="editCountryForm" (ngSubmit)="onEditSubmit()">
                <!-- Country Name Field -->
                <div class="form-group">
                    <label for="edit_country_name">Country Name *</label>
                    <app-input-shared 
                        id="edit_country_name"
                        type="text" 
                        placeholder="Enter country name" 
                        formControlName="country_name"
                        [class.error]="editCountryName?.invalid && editCountryName?.touched" />
                    <div *ngIf="editCountryName?.invalid && editCountryName?.touched" class="error-message">
                        <span *ngIf="editCountryName?.errors?.['required']">Country name is required</span>
                    </div>
                </div>

                <!-- Country Image Field -->
                <div class="form-group">
                    <label for="edit_country_image">Country Image</label>
                    <input 
                        id="edit_country_image"
                        type="file" 
                        (change)="onEditFileSelected($event)"
                        class="form-control" />
                    <div *ngIf="selectedEditFile" class="file-info">
                        Selected file: {{ selectedEditFile.name }}
                    </div>
                    <div *ngIf="editingCountry?.country_image && !selectedEditFile" class="file-info">
                        Current image will be kept
                    </div>
                </div>

                <!-- Status Field -->
                <div class="form-group">
                    <label for="edit_country_status">Status</label>
                    <div class="checkbox-group">
                        <input 
                            id="edit_country_status"
                            type="checkbox" 
                            formControlName="status"
                            class="checkbox-input" />
                        <label for="edit_country_status" class="checkbox-label">
                            Active
                        </label>
                    </div>
                </div>

                <div class="form-actions">
                    <app-button-shared 
                        variant="secondary" 
                        text="Cancel" 
                        type="button"
                        (click)="onEditCancel()" />
                    <app-button-shared 
                        variant="warning" 
                        text="Update Country" 
                        type="submit"
                        [disabled]="editCountryForm.invalid" />
                </div>
            </form>
        </div>
    </div>
</div>